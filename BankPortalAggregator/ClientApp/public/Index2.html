<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>JWT в ASP.NET Core Web API</title>
</head>
<body>
    <div class="userInfo" style="display:none;">
        <p>Вы вошли как: <span class="userName"></span></p>
        <input type="button" value="Выйти" id="logOut" />
    </div>
    <div class="loginForm">
        <h3>Вход на сайт</h3>
        <label>Введите email</label><br />
        <input type="email" id="emailLogin" /> <br /><br />
        <label>Введите пароль</label><br />
        <input type="password" id="passwordLogin" /><br /><br />
        <input type="submit" id="submitLogin" value="Логин" />
    </div>
    <div>
        <input type="submit" id="getDataByLogin" value="Данные по логину" />
    </div>
    <div>
        <input type="submit" id="getDataByRole" value="Данные по роли" />
    </div>
    <div>
        <input type="submit" id="testLogin" value="Тест логин" />
    </div>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script>
        var tokenKey = "accessToken";
        var accessToken = {
            accessToken: 'eyJhbGciOiJSUzI1NiIsImtpZCI6IjI2ZmM0Y2QyM2QzODdjYmM0OTBmNjBkYjU0YTk0YTZkZDE2NTM5OTgiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJhY2NvdW50cy5nb29nbGUuY29tIiwiYXpwIjoiNDE5OTQwODYxMTAwLTRsaGVrNzBkMHI0ZDI5YXRwN2FobGkwcW10OHVxb212LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiYXVkIjoiNDE5OTQwODYxMTAwLTRsaGVrNzBkMHI0ZDI5YXRwN2FobGkwcW10OHVxb212LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwic3ViIjoiMTE4MTg4NDExNzI1MTkyODMwOTkzIiwiZW1haWwiOiJjdGFuaW4yQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiS1ZmelBMMGZaVjYzb05iYkxMNUZyUSIsIm5hbWUiOiJJc2thbmRlciBLaGFraW16aGFub3YiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy1haFF4Q3BzTlVUdy9BQUFBQUFBQUFBSS9BQUFBQUFBQUFBQS9BQ0hpM3JmYmNXbFFYdUZhS3Q2REJXZHF2WjdtdGt4ZnNnL3M5Ni1jL3Bob3RvLmpwZyIsImdpdmVuX25hbWUiOiJJc2thbmRlciIsImZhbWlseV9uYW1lIjoiS2hha2ltemhhbm92IiwibG9jYWxlIjoicnUiLCJpYXQiOjE1NTYzOTYxMjMsImV4cCI6MTU1NjM5OTcyMywianRpIjoiM2M4YWRiOWU4YWRjNGY5ZGI0MjA4YTJmZGJiN2Y3MDEwYTliZGIyNiJ9.TN59XY2vhKELx8IvB7Kj767stwaFhUSdSXbivgvdZo1UNQ_JYK-c3ZZBA6t4JP-i3hdrxpw0ERxl8PqjnX7YYS7zs8Kumca_7_o9EYUhCoJ4lhWjMFwcFVeQlun7YCi7J0oGE9hTXIgbjd1ek96gJP42ORlZMgLsHHU3cw1kPJaJheQ3_S-8XM_eXQUViy6-wCv5jqxhV0AH9dd38Tng2nQEPz42sYzdBbB5ADxoO6dV9tPuEdsAyJ0A8HO_YAOeineMgb_I3MfGLPbCZjd4sm4OQYu8KfZuNIy2OBHlz9hYZvUG-hwPsAqeI3JYYoonx9r1ymJpMuRBwZLWFdkIQw'
        };
        $('#submitLogin').click(function (e) {
            e.preventDefault();
            var loginData = {
                grant_type: 'password',
                username: $('#emailLogin').val(),
                password: $('#passwordLogin').val()
            };

            $.ajax({
                type: 'POST',
                url: '/api/products/token',
                data: loginData
            }).success(function (data) {
                //$('.userName').text(data.username);
                //$('.userInfo').css('display', 'block');
                //$('.loginForm').css('display', 'none');
                // сохраняем в хранилище sessionStorage токен доступа
                sessionStorage.setItem(tokenKey, data.accessToken);
                console.log(data.access_token);
            }).fail(function (data) {
                console.log(data);
            });
        });

        $('#logOut').click(function (e) {
            e.preventDefault();
            $('.loginForm').css('display', 'block');
            $('.userInfo').css('display', 'none');
            sessionStorage.removeItem(tokenKey);
        });

        $('#getDataByLogin').click(function (e) {
            e.preventDefault();
            $.ajax({
                type: 'GET',
                url: '/api/products/GetAuthorizeResource',
                beforeSend: function (xhr) {

                    var token = sessionStorage.getItem(tokenKey);
                    xhr.setRequestHeader("Authorization", token);
                },
                success: function (data) {
                    alert(data);
                },
                fail: function (data) {
                    console.log(data);
                }
            });
        });
        $('#getDataByRole').click(function (e) {
            e.preventDefault();
            $.ajax({
                type: 'GET',
                url: '/api/values/getrole',
                beforeSend: function (xhr) {

                    var token = sessionStorage.getItem(tokenKey);
                    xhr.setRequestHeader("Authorization", "Bearer " + token);
                },
                success: function (data) {
                    alert(data);
                },
                fail: function (data) {
                    console.log(data);
                }
            });
        });

        $('#testLogin').click(function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/api/account/login',
                data: accessToken,
                success: function (data) {
                    alert(data);
                },
                fail: function (data) {
                    console.log(data);
                }
            });
        });
    </script>
</body>
</html>